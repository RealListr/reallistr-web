<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>RealListr • Connect Centre (Lite)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --border:#e5e7eb; --muted:#6b7280; --blue:#2563eb; --bg:#fff; }
    *{ box-sizing:border-box }
    body{ font:16px/1.5 system-ui,Segoe UI,Roboto,Arial,sans-serif; margin:28px auto; max-width:1100px; padding:0 16px; background:#fff; color:#111;}
    .title{ font-size:28px; font-weight:800; margin:0 0 8px; }
    .muted{ color:var(--muted); }
    .section{ border:1px solid var(--border); border-radius:16px; background:#fff; padding:16px; }
    .row{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; align-items:center; }
    .input{ height:44px; border:1px solid #d1d5db; border-radius:12px; padding:0 12px; width:100%; }
    textarea.input{ height:100px; resize:vertical; padding:10px 12px; }
    .btn{ height:42px; padding:0 16px; border-radius:12px; border:1px solid var(--border); background:#fff; cursor:pointer; }
    .chips{ display:flex; flex-wrap:wrap; gap:6px; margin-top:6px; }
    .chip{ padding:4px 8px; border:1px solid var(--border); border-radius:999px; background:#fff; font-size:12px; }
    .listing{ border:1px solid var(--border); border-radius:16px; padding:16px; display:flex; gap:16px; align-items:flex-start; background:#fff; }
    .listing img{ width:100px; height:100px; object-fit:cover; border-radius:12px; background:#f3f4f6; }
    .listing-body{ flex:1; }
    .feed{ display:flex; flex-direction:column; gap:12px; margin-top:12px; }
    .langbar{display:flex;gap:8px;align-items:center;margin:8px 0 12px}
    .langbar select{height:34px;border:1px solid var(--border);border-radius:10px;padding:0 10px;background:#fff}
    .tr { color:#6b7280; font-weight:500; margin-left:.25rem; }
  </style>
</head>
<body>
  <h1 class="title">RealListr • Connect Centre</h1>
  <p class="muted">Lite mode — no login, just data.</p>

  <div class="langbar">
    <strong>Language</strong>
    <select id="lang-mode" aria-label="Language mode">
      <option value="en">English</option>
      <option value="en+zh">English + 中文 (Simplified)</option>
      <option value="en+zh-HANT">English + 中文（繁體）</option>
      <option value="en+vi">English + Tiếng Việt</option>
      <option value="en+ar">English + العربية</option>
      <option value="en+hi">English + हिंदी</option>
      <option value="en+pa">English + ਪੰਜਾਬੀ</option>
    </select>
    <span class="muted"> UI labels only — your listing data stays as typed.</span>
  </div>

  <section class="section" style="margin:0 0 20px">
    <h2 id="feed-title" style="margin:0 0 6px;font-size:22px">Feed Preview</h2>
    <div id="feed" class="feed"></div>
  </section>

  <h2 class="title" style="font-size:24px">Agent Listing</h2>
  <div class="section" style="margin:12px 0 16px">
    <div class="row">
      <input id="a-title" class="input" placeholder="Listing Title" />
      <input id="a-price" class="input" placeholder="Price (e.g. $795,000)" />
      <input id="a-address" class="input" placeholder="Address" />
    </div>
    <div class="row" style="margin-top:8px">
      <input id="a-media" class="input" placeholder="Image URL (optional)" />
      <select id="a-ptype" class="input" style="height:44px">
        <option value="">Property type…</option>
        <option>House</option><option>Townhouse</option><option>Apartment</option>
        <option>Unit</option><option>Villa</option><option>Office</option>
      </select>
      <select id="a-sale" class="input" style="height:44px">
        <option value="">Sale method…</option>
        <option>Auction</option><option>For Sale</option><option>EOI</option>
        <option>For Lease</option><option>Private Treaty</option>
      </select>
    </div>

    <div style="margin-top:10px">
      <label class="muted" style="font-size:12px">Description</label>
      <textarea id="a-info" class="input" placeholder="Key details, inclusions…"></textarea>
    </div>

    <h4 style="margin:12px 0 8px">Highlights (up to 6)</h4>
    <div style="display:grid;gap:8px;grid-template-columns:repeat(3,minmax(0,1fr))">
      <input class="input hi" placeholder="3 Bed" />
      <input class="input hi" placeholder="2 Bath" />
      <input class="input hi" placeholder="1 Car" />
      <input class="input hi" placeholder="Study" />
      <input class="input hi" placeholder="Pool" />
      <input class="input hi" placeholder="Pet friendly" />
    </div>

    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="clear" class="btn" type="button">Clear</button>
    </div>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);
    const escapeHtml = (s)=> String(s??"").replace(/[&<>"]/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[c]));
    const els = {
      feed: $("feed"), title:$("a-title"), price:$("a-price"), address:$("a-address"),
      media:$("a-media"), info:$("a-info"), ptype:$("a-ptype"), sale:$("a-sale"),
      his:[...document.querySelectorAll(".hi")], clear:$("clear")
    };
    function readFormItem(){
      return {
        title: els.title.value.trim(), price: els.price.value.trim(), address: els.address.value.trim(),
        media: els.media.value.trim(), info: els.info.value.trim(),
        propertyType: els.ptype.value || "", saleMethod: els.sale.value || "",
        highlights: els.his.map(i=>i.value.trim()).filter(Boolean).slice(0,6)
      };
    }
    function isEmpty(it){ return ![it.title,it.price,it.address,it.info,(it.highlights||[]).join("")].some(Boolean); }
    function fmtPrice(raw){ const d=(raw||"").replace(/[^\d]/g,""); return d?new Intl.NumberFormat(undefined,{style:"currency",currency:"USD",maximumFractionDigits:0}).format(Number(d)):raw; }
    async function renderFeedFromForm(){
      const it = readFormItem();
      if (isEmpty(it)){ $("feed").innerHTML = `<div class="muted">Type above to preview…</div>`; return; }
      const img = it.media ? `<img src="${escapeHtml(it.media)}" alt="">`
        : `<div style="width:100px;height:100px;border-radius:12px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;color:#6b7280;border:1px solid #e5e7eb">No media</div>`;
      const chips = (it.highlights||[]).map(h=>`<span class="chip">${escapeHtml(h)}</span>`).join("");
      $("feed").innerHTML = `
        <div class="listing">
          ${img}
          <div class="listing-body">
            <h3 style="margin:0 0 4px">${escapeHtml(it.title || "Untitled")}</h3>
            <p style="margin:0"><b>${escapeHtml(it.price || "")}</b>${(it.price&&it.address)?" — ":""}${escapeHtml(it.address || "")}</p>
            <p style="margin:2px 0;color:#6b7280;font-size:14px">
              ${it.propertyType?escapeHtml(it.propertyType)+" · ":""}${escapeHtml(it.saleMethod||"")}
            </p>
            ${chips?`<div class="chips">${chips}</div>`:""}
            ${it.info?`<p style="margin-top:6px">${escapeHtml(it.info)}</p>`:""}
            <div id="mirror-slot"></div>
          </div>
        </div>`;
    }
    ["input","change","blur"].forEach(ev=>{
      [els.title,els.price,els.address,els.media,els.info,els.ptype,els.sale, ...els.his]
        .forEach(el=> el.addEventListener(ev, renderFeedFromForm));
    });
    els.price.addEventListener("blur", ()=>{ els.price.value = fmtPrice(els.price.value); renderFeedFromForm(); });
    els.clear.addEventListener("click", ()=>{ [els.title,els.price,els.address,els.media,els.info].forEach(i=> i.value=""); els.ptype.value=""; els.sale.value=""; els.his.forEach(i=> i.value=""); renderFeedFromForm(); });
    renderFeedFromForm();
  </script>

  <!-- Minimal translation client -->
  <script>
  (function(){
    const _policy={api:{endpoint:"",source_lang:"EN"},targets:[],currencyContext:"AU",
      fields:{title:true,description:true,highlights:true,price:true,address:false}};
    const cache=new Map(), key=(t,tgt,src)=>`${tgt}|${src}|${t}`;
    async function xlate(texts,tgt,src){
      const ep=_policy.api.endpoint; if(!ep) throw new Error("translate endpoint missing");
      const out=new Array(texts.length), todo=[], idx=[];
      texts.forEach((t,i)=>{const k=key(t,tgt,src); if(cache.has(k)) out[i]=cache.get(k); else {todo.push(t); idx.push(i);}});
      if(todo.length){
        const r=await fetch(ep,{method:"POST",headers:{ "Content-Type":"application/json" },
          body:JSON.stringify({texts:todo,target_lang:tgt.toUpperCase(),source_lang:src.toUpperCase()})});
        const data=await r.json(); if(!r.ok) throw new Error(data?.error||`translate_${r.status}`);
        (data.translations||[]).forEach((txt,j)=>{const i=idx[j]; const k=key(todo[j],tgt,src); cache.set(k,txt); out[i]=txt;});
      }
      return out;
    }
    async function makeMirrors(item){
      const src=_policy.api.source_lang||"EN", tgts=_policy.targets||[], mirrors={};
      for(const tgt of tgts){
        const pieces=[], map=[];
        if(_policy.fields.title){map.push("title"); pieces.push(item.title||"");}
        if(_policy.fields.description){map.push("description"); pieces.push(item.info||"");}
        if(_policy.fields.highlights){map.push("highlights"); pieces.push((item.highlights||[]).join(" • "));}
        if(_policy.fields.price){map.push("price"); pieces.push(item.price||"");}
        if(_policy.fields.address){map.push("address"); pieces.push(item.address||"");}
        const res=await xlate(pieces,tgt,src), m={};
        map.forEach((f,i)=>{const v=res[i]||""; if(f==="highlights") m.highlights=v.split(/[•・·]\s*/).map(s=>s.trim()).filter(Boolean);
          else if(f==="price") m.price=((tgt==="zh"||tgt==="zh-HANT")&&_policy.currencyContext==="AU"&&v)?`${v}（澳元）`:v;
          else m[f]=v;});
        mirrors[tgt]=m;
      }
      return mirrors;
    }
    window.RL_Translation={ getPolicy:()=>JSON.parse(JSON.stringify(_policy)), setPolicy:(p)=>Object.assign(_policy,p||{}), makeMirrors };
  })();
  </script>

  <!-- Config: endpoint + dropdown -> targets + mirror injection -->
  <script>
  (function(){
    if(!window.RL_Translation) return;
    let endpoint="http://127.0.0.1:8787/translate";
    const h=location.hostname;
    if(h.endsWith(".app.github.dev"))
      endpoint=`https://${h.replace(/-\d+\.app\.github\.dev$/,"-8787.app.github.dev")}/translate`;
    const p=window.RL_Translation.getPolicy();
    p.api={endpoint,source_lang:"EN"}; p.currencyContext="AU";
    window.RL_Translation.setPolicy(p);

    const MAP={"en":[],"en+zh":["zh"],"en+zh-HANT":["zh-HANT"],"en+vi":["vi"],"en+ar":["ar"],"en+hi":["hi"],"en+pa":["pa"]};
    const sel=document.getElementById("lang-mode");
    function applyTargets(){ const pol=window.RL_Translation.getPolicy(); pol.targets=MAP[sel.value]||[]; window.RL_Translation.setPolicy(pol); }

    const label=(c)=>({"zh":"中文","zh-HANT":"中文（繁體）","vi":"Tiếng Việt","ar":"العربية","hi":"हिंदी","pa":"ਪੰਜਾਬੀ"}[c]||c.toUpperCase());
    async function injectMirrors(){
      const body=document.querySelector("#feed .listing-body"); if(!body) return;
      let slot=body.querySelector("#mirror-slot"); if(!slot){ slot=document.createElement("div"); slot.id="mirror-slot"; body.appendChild(slot); }
      const item = (typeof readFormItem==="function") ? readFormItem() : null; if(!item) return;
      const mirrors = await window.RL_Translation.makeMirrors(item);
      const tgts=(window.RL_Translation.getPolicy().targets)||[];
      let html=""; for(const t of tgts){ const m=mirrors[t]; if(!m) continue;
        html+=`<div class="tr" style="margin-top:10px"><b>${label(t)}</b></div>`;
        if(m.title) html+=`<div class="tr" style="margin-top:4px">${m.title}</div>`;
        if(m.price||m.address) html+=`<div class="tr"><b>${m.price||""}</b>${(m.price&&m.address)?" — ":""}${m.address||""}</div>`;
        if((m.highlights||[]).length) html+=`<div class="chips" style="margin-top:6px">${m.highlights.map(h=>`<span class="chip">${h}</span>`).join("")}</div>`;
        if(m.description) html+=`<p class="tr" style="margin-top:6px">${m.description}</p>`;
      }
      slot.innerHTML=html;
    }

    const prev = window.renderFeedFromForm;
    window.renderFeedFromForm = async function(){ prev && prev(); try{ await injectMirrors(); }catch(e){ console.warn("mirror render failed", e); } };
    if(sel){ sel.addEventListener("change", ()=>{ applyTargets(); window.renderFeedFromForm?.(); }); applyTargets(); }
    window.addEventListener("load", ()=> setTimeout(()=> window.renderFeedFromForm?.(), 0));
  })();
  </script>
</body>
</html>
